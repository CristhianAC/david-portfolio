---
export interface Props {
  isPremium: boolean;
  premiumActiveUntil?: string | null;
  premiumCancelledAt?: string | null;
  premiumStatus?: string;
}

const {
  isPremium,
  premiumActiveUntil,
  premiumCancelledAt,
  premiumStatus = "inactive",
} = Astro.props;

const activeUntilDate = premiumActiveUntil
  ? new Date(premiumActiveUntil)
  : null;
const formattedActiveUntil = activeUntilDate && !Number.isNaN(activeUntilDate.getTime())
  ? new Intl.DateTimeFormat("es-ES", {
      year: "numeric",
      month: "long",
      day: "numeric",
    }).format(activeUntilDate)
  : null;

const cancellationScheduled = Boolean(
  premiumCancelledAt && activeUntilDate && activeUntilDate > new Date()
);
---

<!-- Estado de la suscripción -->
<div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
  <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Estado de la Cuenta</h2>
  
  {isPremium ? (
    <!-- Usuario Premium -->
    <div class="space-y-4">
      <div class="flex items-center justify-between p-4 bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800">
        <div class="flex items-center">
          <div class="w-12 h-12 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center">
            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
          </div>
          <div class="ml-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Cuenta Premium</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">Acceso completo a todo el contenido</p>
          </div>
        </div>
        <div class="text-right space-y-1">
          <span class="inline-flex items-center px-3 py-1 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 rounded-full">
            {cancellationScheduled ? "Activa hasta" : "Activa"}
          </span>
          {formattedActiveUntil && (
            <p class="text-xs text-gray-600 dark:text-gray-400">
              {formattedActiveUntil}
            </p>
          )}
        </div>
      </div>

      <div class="bg-white dark:bg-slate-900/40 border border-yellow-200/70 dark:border-yellow-800/60 rounded-lg p-4">
        <h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-2">
          {cancellationScheduled ? "Cancelación programada" : "Tu suscripción está activa"}
        </h4>
        <p class="text-sm text-gray-600 dark:text-gray-400">
          {cancellationScheduled ? (
            <>Podrás seguir disfrutando de los beneficios Premium hasta el <strong class="font-semibold">{formattedActiveUntil}</strong>.</>
          ) : (
            <>Gracias por apoyar el contenido. Puedes cancelar cuando quieras y seguirás teniendo acceso hasta completar tu periodo actual.</>
          )}
        </p>

        <div class="mt-4 flex flex-wrap items-center gap-3">
          <button
            id="cancel-subscription-button"
            class="inline-flex items-center justify-center rounded-lg border border-red-200 bg-white px-4 py-2 text-sm font-medium text-red-600 transition-colors duration-200 hover:bg-red-50 dark:border-red-800/40 dark:bg-red-900/20 dark:text-red-300 dark:hover:bg-red-900/30"
            type="button"
          >
            Cancelar suscripción
          </button>
          <span class="text-xs uppercase tracking-wide text-gray-400 dark:text-gray-500">
            {premiumStatus === "cancelling" ? "Cancelación pendiente" : "Renovación automática"}
          </span>
        </div>
      </div>
    </div>
  ) : (
    <!-- Usuario Gratuito -->
    <div class="space-y-4">
      <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-slate-700/50 rounded-lg border border-gray-200 dark:border-gray-600">
        <div class="flex items-center">
          <div class="w-12 h-12 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center">
            <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
          </div>
          <div class="ml-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Cuenta Gratuita</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">Acceso limitado al contenido</p>
          </div>
        </div>
        <div class="text-right">
          <span class="inline-flex items-center px-3 py-1 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 rounded-full">
            Básica
          </span>
        </div>
      </div>
      
      <!-- Beneficios de Premium -->
      <div class="bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg border border-blue-200 dark:border-blue-800 p-6">
        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">
          ¿Por qué actualizar a Premium?
        </h4>
        <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
          <li class="flex items-center">
            <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
            Acceso completo a todos los artículos premium
          </li>
          <li class="flex items-center">
            <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
            Contenido exclusivo y tutoriales avanzados
          </li>
          <li class="flex items-center">
            <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
            Sin limitaciones de lectura
          </li>
          <li class="flex items-center">
            <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
            Acceso prioritario a nuevos contenidos
          </li>
        </ul>
      </div>
    </div>
  )}
</div>

<!-- Modal de cancelación -->
<div
  id="cancel-subscription-modal"
  class="fixed inset-0 z-50 hidden h-full w-full items-center justify-center bg-black/40 px-4 py-6"
>
  <div
    data-modal-content
    class="w-full max-w-md rounded-xl border border-gray-200 bg-white p-6 shadow-xl dark:border-gray-700 dark:bg-slate-900"
  >
    <div class="flex items-center justify-between">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
        ¿Cancelar suscripción?
      </h3>
      <button
        id="cancel-cancel-subscription"
        type="button"
        class="rounded-md p-1 text-gray-500 transition hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-slate-800"
        aria-label="Cerrar"
      >
        <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path
            fill-rule="evenodd"
            d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
            clip-rule="evenodd"
          />
        </svg>
      </button>
    </div>

    <p class="mt-4 text-sm text-gray-600 dark:text-gray-400">
      Tu plan seguirá activo hasta completar el mes que ya pagaste. Una vez llegue la fecha de renovación no se hará ningún cobro adicional.
    </p>

    {formattedActiveUntil && (
      <p class="mt-3 text-sm font-medium text-gray-900 dark:text-gray-200">
        Acceso vigente hasta:
        <span class="block text-base text-gray-900 dark:text-gray-100">
          {formattedActiveUntil}
        </span>
      </p>
    )}

    <div class="mt-6 flex flex-col gap-2 sm:flex-row-reverse sm:justify-end">
      <button
        id="confirm-cancel-subscription"
        type="button"
        class="inline-flex items-center justify-center rounded-lg bg-red-600 px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:bg-red-500 dark:hover:bg-red-400 dark:focus:ring-offset-slate-900"
      >
        Sí, cancelar plan
      </button>
      <button
        id="dismiss-cancel-subscription"
        type="button"
        class="inline-flex items-center justify-center rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-slate-800 dark:focus:ring-offset-slate-900"
      >
        Seguir siendo Premium
      </button>
    </div>
  </div>
</div>