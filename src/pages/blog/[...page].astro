---
import { getCollection } from "astro:content"
import type { GetStaticPaths } from "astro"
import BlogLayout from "../../layouts/BlogLayout.astro"
import Header from "../../components/Header.astro"
import Footer from "../../components/Footer.astro"
import PostCard from "../../components/PostCard.astro"
import FeaturedCard from "../../components/FeaturedCard.astro"
import Pagination from "../../components/Pagination.astro"
import SiteOptions from "../../site.config.mjs"

export const getStaticPaths = (async ({ paginate }) => {
  const allPosts = await getCollection("article")
  const sortedPosts = allPosts.sort((a, b) => new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf())

  return paginate(sortedPosts, {
    pageSize: 8, // Number of posts per page
  })
}) satisfies GetStaticPaths

const { page } = Astro.props

// Get featured posts for the first page only
const allPosts = await getCollection("article")
const featuredPosts = page.currentPage === 1 ? allPosts.filter((post) => post.data.featured).slice(0, 3) : []

const pageTitle = page.currentPage === 1 ? SiteOptions.siteTitle : `Blog - Page ${page.currentPage} | ${SiteOptions.siteTitle}`
---

<BlogLayout title={pageTitle}>
  <Header />

  <!-- Light Horizontal Bar -->
  <hr class="border-t border-gray-200 dark:border-gray-700 my-8" />

  <!-- Page Title for non-first pages -->
  <!-- {
    page.currentPage > 1 && (
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2">Blog Posts</h1>
        <p class="text-gray-600 dark:text-gray-400">
          Page {page.currentPage} of {page.lastPage}
        </p>
      </div>
    )
  } -->

  <!-- Featured Blog Posts (only on first page) -->
  <!-- {
    featuredPosts.length > 0 && (
      <section class="mb-16">
        <h2 class="text-2xl font-semibold mb-8 text-center">Featured Posts</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          {featuredPosts.map((post) => (
            <FeaturedCard post={post} />
          ))}
        </div>
        <hr class="border-t border-gray-200 dark:border-gray-700 my-12" />
      </section>
    )
  } -->

  <!-- Latest Blog Posts -->
  <section>
    <!-- <h2 class={`text-2xl font-semibold mb-8  text-center`}> -->
    <!-- {page.currentPage === 1 ? "Latest Posts" : "All Posts"} -->
    <!-- All Posts -->
    <!-- </h2> -->
    <ul class="space-y-4">
      {page.data.map((post) => <PostCard post={post} />)}
    </ul>
  </section>

  <!-- Pagination -->
  <Pagination page={page} />

  <!-- Minimal Footer -->
  <Footer />
</BlogLayout>
